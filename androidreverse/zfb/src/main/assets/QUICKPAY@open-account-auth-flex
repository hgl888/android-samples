{"time":"0010","tplId":"QUICKPAY@open-account-auth-flex","publishVersion":"150924","tag":"QUICKPAY","name":"open-account-auth-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","children":[{"text":"// 别名\nvar create = amc.fn.create;\nvar getTag = amc.fn.getById;\nvar hide = amc.fn.hide;\nvar show = amc.fn.show;\n\nvar rpc = amc.rpcData;\nvar params = rpc.params || {};\n\nvar checkedPng = amc.path + 'alipay_msp_checked';\nvar logoPng = params.logo_url || '';\nvar authTitle = params.auth_title || '';\nvar optionTitle = params.auth_option_title || '';\nvar authOptionList = params.auth_option_list || '';\n\nvar account = rpc.hidden_logon_id || '';\nvar service = params.service;\n//是否显示切换账户 @松然\nvar isShowChangeAcc = params.show_change_acc;\n\n// @连挚\nvar isSamsungAuth = (service === 'com.alipay.vendorpay.validate');\n\n// 服务端: @乐进， 模板: @醉杭\nvar isInsideAuth = (params.auth_scene === 'inside');\n\nvar checkboxs = [];\nvar protocols = [];\nvar authTypeText = (params.auth_type === 'LOGIN') ? '{{login}}' : '{{auth}}';\nvar canAuth = true;\n\n// 初始化\nfunction init() {\n    try {\n        initUI();\n        \n        if(amc.fn.logPageInit) {\n            amc.fn.logPageInit(true);\n        }\n    } catch(e) {\n        if(amc.fn.logPageInit) {\n            amc.fn.logPageInit();\n        }\n    }\n}\n\nfunction initUI() {\n    \n    var nav = amc.fn.navBack(false, amc.fn.i18nPlaceholderReplace('{{alipay_with_sth}}', authTypeText), null, null, onBack, null);\n    getTag('body').insertBefore(nav,getTag('mainBody'));\n    \n    getTag('logo').src = logoPng;\n    getTag('authTitle').innerText = authTitle;\n    getTag('tipText').innerText = amc.fn.i18nPlaceholderReplace('{{auth_sth}}', authTypeText);\n    \n    getTag('account').innerText = account;\n    getTag('optionTitle').innerText = optionTitle;\n    getTag('btnText').innerText = amc.fn.i18nPlaceholderReplace('{{confirm_sth}}', authTypeText);\n    getTag('btnText').style.maxWidth = window.innerWidth - 70;\n\n    var rightBox = getTag('rights');\n    var textList = params.auth_text_list;\n    if (textList){\n        var tmpList = [];\n\n        for(var i = 0; i < textList.length; i++) {\n            tmpList[tmpList.length] = textList[i];\n        }\n\n        // @连挚 厂商支付授权\n        if(isSamsungAuth) {\n            tmpList[tmpList.length] = '{{auth_qrcode_info}}';\n        }\n\n        for(var i = 0; i < tmpList.length; i++) {\n            var label = create('label', 'amc-margin-b amc-font-s amc-text-light-color amc-ellipsis', rightBox);\n            label.innerText = (i+1) + '. ' + tmpList[i];\n        }\n    }\n    \n    // @连挚、@松然\n    if(isShowChangeAcc && !isSamsungAuth){\n        show('changeBtn');\n    } else {\n        hide('changeBtn');\n    }\n    \n\tcheckboxs = getOptionList(authOptionList,'TEXT');\n\tif(checkboxs && checkboxs.length > 0){\n        for(var idx in checkboxs){\n            initCheckbox(checkboxs[idx]);\n        }\n\t}\n    \n\tprotocols = getOptionList(authOptionList,'URL');\n    if (protocols.length === 0){\n        hide('protocolArea');\n    }\n    \n    if(isInsideAuth && params.insideTip) {\n        show('insideTipBox');\n        getTag('insideTip').innerText = params.insideTip;\n    }\n    \n    getTag('mainBody').style.height = amc.specs.bodyHeight;\n}\n\n// 获取选项列表\nfunction getOptionList(optionList, key){\n\tvar list = [];\n\tfor(var idx in optionList){\n\t\tif(optionList[idx].type === key){\n\t\t\tlist.push(optionList[idx]);\n\t\t}\n\t}\n\treturn list;\n}\n\n// 初始化checkbox\nfunction initCheckbox(checkitem){\n    var checkArea = getTag('checkArea');\n    var checkCell = create('div');\n    checkCell.className = 'amc-align-center amc-margin-b-s';\n    \n    var checkbox;\n    // 强制选中状态用图片作为checkbox,因为鸟巢暂时不支持disable状态\n    if (checkitem.forced){\n        checkbox = create('img');\n        checkbox.className = 'amc-check-img';\n        checkbox.src = checkedPng;\n        checkCell.appendChild(checkbox);\n    } else {\n        checkbox = create('input');\n        checkCell.appendChild(checkbox);\n        checkbox.type='checkbox';\n        checkbox.className = 'amc-checkbox';\n        checkbox.checked = checkitem.checked;\n    }\n    checkbox.className = checkbox.className + ' amc-margin-r-xs';\n    \n    checklabel = create('label');\n    checklabel.innerText = checkitem.optionText;\n    checklabel.className = 'amc-font-m amc-flex-1 amc-ellipsis';\n    checkCell.appendChild(checklabel);\n    \n    checkArea.appendChild(checkCell);\n    checkitem['_checkbox'] = checkbox;\n}\n\n// 打开协议\nfunction showProtocol() {\n    for (var i = 0; i < protocols.length; i++) {\n        protocols[i]['text'] = '{{serve_protocol}}';\n        protocols[i]['url'] = protocols[i]['optionText'];\n    }\n    amc.fn.showProtocolList(protocols);\n}\n\n// 验密请求\nfunction onSubmit(){\n    if (!canAuth){\n        return;\n    }\n    \n\tvar agrees = [];\n\tfor(var i = 0;i < checkboxs.length; i++){\n        if (checkboxs[i].forced){\n            agrees.push(checkboxs[i].optionKey);\n        } else if(checkboxs[i]['_checkbox'].checked === true ||  checkboxs[i]['_checkbox'].checked === '1'){\n            agrees.push(checkboxs[i].optionKey);\n        }\n\t}\n    \n    agrees.push('PROTOCOL');\n    var obj;\n    \n    if(isSamsungAuth)\n    {\n        obj = {\n            'param':{'agree': agrees,'service': 'com.alipay.vendorpay.validate'},\n            'action':{'name': '/open/service','loadtxt': ''}\n        };\n    } else if(isInsideAuth) {\n        obj = {\n            'param':{'agree':agrees,'service': 'com.alipay.account.auth'},\n            'action':{'name':'/open/service','loadtxt':''}\n        };\n    } else {\n        obj = {\n            'param':{'agree':agrees},\n            'action':{'name':'/account/auth','loadtxt':''}\n        };\n    }\n    \n    amc.fn.playGif(getTag('gifImg'),amc.res.loading);\n    getTag('btnText').innerText = '{{confirming_upgrade}}';\n\t\n    document.submit(obj);\n    setTimeout(resetBtn, 3000);\n    canAuth = false;\n}\n\n// 更换账户\nfunction onSwitchAccount(){\n    var obj = {'action':{'name':'/cashier/switchAccount'}};\n    document.submit(obj);\n}\n\n// 重置按钮\nfunction resetBtn(){\n    amc.fn.playGif(getTag('gifImg'),'');\n    getTag('btnText').innerText = amc.fn.i18nPlaceholderReplace('{{confirm_sth}}', authTypeText);\n    canAuth = true;\n}\n\n// Android硬返回\nfunction onKeyDown(){\n    if(event.which == 4){\n        onBack();\n    }\n}\n\n// 退出\nfunction onBack() {\n    amc.fn.exitConfirm();\n}","tag":"text"}]},{"tag":"style","children":[{"text":".bold-text{font-weight:bold}\n.amc-nav-r-box {}\n.amc-nav-l-text {color:#108ee9;font-size:14px;text-align:left;}\n.agree-label {\n    max-width: 100px;\n}\n.change-btn {\n    max-width: 100px;\n}\n.stretch-self {\n    align-self: stretch;\n}\n.inside-tip-box {\n    min-height: 63px;\n    padding: 5px 15px 24px 15px;\n    justify-content: flex-end;\n    \n}\n.inside-tip {\n    font-size: 14px;\n    color: #a5a5a5;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{"id":"topBody","tag":"div","children":[{"tag":"div","children":[{"id":"logo","tag":"img","css":"open-auth-img"}],"css":"amc-pd-tb"},{"tag":"div","children":[{"id":"authTitle","tag":"label","css":"amc-flex-1 amc-text-center amc-ellipsis amc-font-xl"}],"css":"amc-pd-b amc-pd-lr stretch-self"},{"tag":"div","css":"amc-abs-space-v-s"},{"tag":"div","children":[{"id":"tipText","tag":"label","children":[{"text":"{{use_alipay_auth}}","tag":"text"}],"css":"amc-font-xl amc-text-center amc-flex-1 amc-ellipsis-2-line"}],"css":"amc-pd-lr stretch-self"},{"tag":"div","css":"amc-abs-space-v-ss"},{"tag":"div","children":[{"id":"account","tag":"label","css":"amc-font-xl amc-margin-r-xs"},{"id":"changeBtn","tag":"label","children":[{"text":"{{sel}}","tag":"text"}],"onclick":"onSwitchAccount()","css":"change-btn amc-ellipsis amc-font-xl amc-theme-color"}],"css":"amc-pd-b"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-pd-t amc-v-box amc-align-center amc-bg-white"},{"tag":"div","children":[{"id":"tipArea","tag":"div","children":[{"tag":"div","css":"amc-abs-space-v-l"},{"id":"optionTitle","tag":"label","css":"amc-margin-b-s amc-font-xl bold-text"},{"id":"rights","tag":"div","css":"amc-v-box"}],"css":"amc-pd-lr amc-v-box"},{"tag":"div","css":"amc-abs-space-v-s"},{"id":"checkArea","tag":"div","css":"amc-pd-lr amc-v-box"},{"tag":"div","css":"amc-abs-space-v-s"},{"id":"container","tag":"div","children":[{"id":"confirmBtn","tag":"div","children":[{"id":"gifImg","tag":"embed","type":"MQPPayGifView","css":"amc-btn-img amc-hidden"},{"id":"btnText","tag":"label","children":[{"text":"{{confirm_auth}}","tag":"text"}],"css":"amc-btn-text-color amc-font-super-l amc-btn-ellpsis"}],"onclick":"onSubmit()","css":"amc-btn-primary amc-justify-center amc-align-center"}],"css":"amc-pd-lr amc-pd-b"},{"id":"protocolArea","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{agree}}","tag":"text"}],"css":"agree-label  amc-ellipsis-2-line amc-font-m amc-margin-r-xs"},{"id":"protocol","tag":"label","children":[{"text":"{{serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"amc-font-m amc-theme-color amc-flex-1 amc-ellipsis-2-line"}],"css":"amc-pd-lr amc-pd-b"}],"css":"amc-v-box"},{},{"id":"insideTipBox","tag":"div","children":[{"id":"insideTip","tag":"label","css":"inside-tip amc-text-center amc-ellipsis-2-line"}],"css":"amc-v-box amc-flex-1 inside-tip-box amc-hidden"}],"css":"amc-v-box amc-scroll-flex"}],"onkeydown":"onKeyDown()","css":"amc-body"}]},"format":"JSON","tplVersion":"5.1.3"}