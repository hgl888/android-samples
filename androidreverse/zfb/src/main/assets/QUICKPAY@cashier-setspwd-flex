{"time":"0004","tplId":"QUICKPAY@cashier-setspwd-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-setspwd-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var create=amc.fn.create;var rpc=amc.rpcData;var tipsSet=\"{{spwd_pay}}\";var tipsRepeat=\"{{confirm_again}}\";var actionSet=\"\";var actionRepeat=\"\";var protocols=[{text:\"{{alipay_serve_protocol}}\",url:\"https://ds.alipay.com/fd-inhm9zcq/index.html\"},{text:\"{{baoxian_protocol}}\",url:\"https://ds.alipay.com/baoxian/zhxprotocol.htm\"}];if(rpc.protocols&&rpc.protocols.length>=2){protocols=rpc.protocols}var canGiveInsurance=false;var showServiceProtocol=true;var protocolCount=0;var protocolIndex=0;var checkbox=null;var checkLabel=null;function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var d=amc.fn.getNav(amc.res.navBack,\"{{return}}\",\"{{set_pwd}}\",null,null,onBack,null);getTag(\"body\").insertBefore(d,getTag(\"mainBody\"));if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}if(rpc.setSpwdType===\"quser\"){actionSet=\"/cashier/setSpwd\";actionRepeat=\"/cashier/saveSpwd\"}else{if(rpc.setSpwdType===\"complete\"){tipsSet=\"{{pay_spwd}}\";actionSet=\"/complete/spwd\";actionRepeat=\"/complete/savespwd\";showServiceProtocol=false}}if(rpc.showLogo){var c=getTag(\"accountLogo\");var a=amc.path+\"alipay_msp_logo_large\";c.src=rpc.logoUrl||a;c.failureValue=a;c.defaultvalue=a;show(c);show(\"accountBox\")}if(rpc.loginId){var b=getTag(\"loginId\");b.innerText=amc.fn.i18nPlaceholderReplace(\"{{alipay_login_id}}\",rpc.loginId);if(!rpc.showLogo){b.style.marginTop=0}show(b);show(\"accountBox\")}initCheckBox();getTag(\"tips\").innerText=tipsSet||\"\";getTag(\"spwd\").focus()}function onSpwdInput(){resetErrMsg();var a=getTag(\"spwd\");if(a.value.length>=6){onFirstInput()}}function onSpwdRepeatInput(){resetErrMsg();var a=getTag(\"spwdRepeat\");var b=(a.value.length>=6);getTag(\"nextBtn\").disabled=!b;if(b){if(amc.isAndroid){document.submit({action:{name:\"loc:hideKeyboard\"}})}else{amc.fn.hideKeyboard()}}}function handleResponse(b){b=b||{};var a=(b.recommendNoPwd===\"true\");if(checkbox){checkbox.checked=(b.selectOpenNoPwd===\"true\")}canGiveInsurance=(b.canGiveBaoxian===\"true\");if(checkLabel){checkLabel.innerText=canGiveInsurance?\"{{can_insuranced}}\":\"{{insuranced}}\"}if(a){show(\"checkArea\")}else{hide(\"checkArea\")}protocolCount=0;protocolIndex=0;if(showServiceProtocol){protocolCount++;protocolIndex=0}if(a&&canGiveInsurance){protocolCount++;protocolIndex=1}show(\"agreeProtocol\");if(protocolCount===1){getTag(\"protocol\").innerText=protocols[protocolIndex][\"text\"]||\"\";if(protocolIndex===1){getTag(\"agree\").innerText=\"{{look}}\"}}else{if(protocolCount===2){getTag(\"protocol\").innerText=\"{{user_agreement}}\"}else{hide(\"agreeProtocol\")}}}function onFirstInput(){var c={action:{name:actionSet}};var b=getTag(\"spwd\").value;var a={spwd:b};a.encryptType=\"RSA\";c.param=a;document.asyncSubmit(c,function(d){if(d&&d.status===\"0001\"){handleResponse(d);hide(\"spwdBox\");hide(\"firstPage\");show(\"spwdRepeatBox\");show(\"secondPage\");getTag(\"tips\").innerText=tipsRepeat;getTag(\"spwdRepeat\").value=\"\";getTag(\"nextBtn\").disabled=true;getTag(\"spwdRepeat\").focus()}else{if(d&&d.status===\"0000\"){getTag(\"spwd\").disabled=false;getTag(\"spwd\").value=\"\";if(d.errMsg){resetErrMsg(d.errMsg)}getTag(\"spwd\").focus()}}})}function onSubmit(){var d={action:{name:actionRepeat}};var c=getTag(\"spwdRepeat\");var b=c.value;var a={spwd:b};a.encryptType=\"RSA\";a.openNopwdSwitch=(checkbox&&(checkbox.checked===true||checkbox.checked===\"1\"));a.openBaoxian=canGiveInsurance;d.param=a;document.asyncSubmit(d,function(e){if(e.status===\"0000\"){if(e.errMsg){resetErrMsg(e.errMsg)}againOnce()}amc.fn.shouldShowBtnIndicator(e,\"nextBtn\",\"loading\")});amc.fn.shouldShowBtnIndicator({pageloading:\"1\"},\"nextBtn\",\"loading\")}function againOnce(){getTag(\"spwd\").value=\"\";show(\"spwdBox\");hide(\"spwdRepeatBox\");hide(\"secondPage\");show(\"firstPage\");getTag(\"tips\").innerText=tipsSet;getTag(\"spwd\").focus()}function showProtocol(){if(protocolCount===1){document.submit({action:{name:\"loc:openweb('\"+protocols[protocolIndex][\"url\"]+\"','\"+protocols[protocolIndex][\"text\"]+\"')\"}});return}var b=new Array();for(var a=0;a<protocols.length;a++){b.push(protocols[a][\"text\"])}document.actionSheet({btns:b,cancelBtn:\"{{cancel}}\"},function(c){document.submit({action:{name:\"loc:openweb('\"+protocols[c.index][\"url\"]+\"','\"+protocols[c.index][\"text\"]+\"')\"}})})}function resetErrMsg(a){a=a||\"\";if(a){show(\"errMsgBox\")}else{hide(\"errMsgBox\")}getTag(\"errMsg\").innerText=a||\"\"}function initCheckBox(){var a=getTag(\"checkArea\");checkbox=create(\"input\",\"amc-checkbox amc-margin-r-s\",a);checkbox.type=\"checkbox\";checkbox.checked=false;var b=create(\"div\",\"amc-flex-1\",a);checkLabel=create(\"label\",\"amc-font-m amc-flex-1\",b)}function onBack(){amc.fn.exitConfirm()}function onKeyDown(){if(event.which==4){onBack()}};","tag":"text"}]},{"tag":"style","children":[{"text":".err-msg-box {\n    justify-content:center;\n    display:none;\n    margin-top: 20px;\n}\n.err-msg-text {\n    color:#f4333c;\n    font-size: 14px;\n}\n.pwd-tip {\n    color: #777;\n    font-size: 14px;\n    text-align: center;\n}\n.check-area-box {\n    align-items: flex-start;\n}\n.amc-nav-r-box {\n    display: none;\n}\n.agree-label {\n    max-width: 120px;\n}\n\n.account-logo {\n    height: 45px;\n    width: 45px;\n}\n\n.login-id {\n    font-size: 17px;\n    margin-top: 9px;\n}\n\n.pd-tb-l {\n    padding-top : 20px;\n    padding-bottom: 20px;\n}\n.margin-t-l {\n    margin-top: 20px;\n}\n\n.pd-t {\n    padding-top: 15px;\n}\n\n.pd-t-l {\n    padding-top: 20px;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{},{"id":"accountBox","tag":"div","children":[{"id":"accountLogo","tag":"img","css":"account-logo amc-hidden"},{"id":"loginId","tag":"label","css":"login-id amc-ellipsis amc-hidden"}],"css":"amc-v-box amc-align-center amc-bg-white amc-hidden pd-tb-l"},{"tag":"div","css":"amc-1px-line amc-self-stretch"},{"tag":"div","children":[{},{"tag":"div","children":[{"id":"tips","tag":"label","css":"amc-text-center amc-flex-1"}],"css":"amc-flex-center margin-t-l"},{"tag":"div","children":[{"id":"spwdBox","tag":"div","children":[{"id":"spwd","tag":"embed","value":"","src":"payspwd","type":"MQPPayPwdView","css":"amc-pwd-input amc-spwd-height","oninput":"onSpwdInput()"}],"css":"amc-spwd-box"},{"id":"spwdRepeatBox","tag":"div","children":[{"id":"spwdRepeat","tag":"embed","value":"","src":"payspwd","type":"MQPPayPwdView","css":"amc-pwd-input amc-spwd-height","oninput":"onSpwdRepeatInput()"}],"css":"amc-spwd-box amc-hidden"}],"css":"amc-v-box amc-pd-t"},{},{"id":"errMsgBox","tag":"div","children":[{"id":"errMsg","tag":"label","children":[{"text":"{{pwd-error-repeat}}","tag":"text"}],"css":"err-msg-text amc-flex-1 amc-ellipsis-2-line"}],"css":"err-msg-box"},{},{"id":"firstPage","tag":"div","children":[{"tag":"label","children":[{"text":"{{pwd-notice}}","tag":"text"}],"css":"pwd-tip amc-ellipsis-2-line"}],"css":"pd-t amc-v-box"},{},{"id":"secondPage","tag":"div","children":[{"tag":"div","children":[{"id":"checkArea","tag":"div","css":"check-area-box amc-pd-b"},{"id":"agreeProtocol","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{agree}}","tag":"text"}],"css":"amc-align-self-start amc-font-m amc-margin-r-xs agree-label amc-ellipsis-2-line"},{"id":"protocol","tag":"label","children":[{"text":"{{alipay_serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"amc-align-self-start amc-font-m amc-theme-color amc-flex-1"}],"css":"agree-box amc-margin-b-l"}],"css":"amc-v-box"},{"tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img amc-text-white-clolor amc-hidden"},{"id":"nextBtn","tag":"button","children":[{"text":"{{next}}","tag":"text"}],"onclick":"onSubmit()","css":"amc-btn-primary","disabled":"true"}],"css":"amc-align-center amc-justify-center amc-btn-primary"}],"css":"amc-v-box amc-hidden pd-t-l"}],"css":"amc-pd-lr amc-v-box"}],"css":"amc-v-box amc-pd-b"}],"onkeydown":"onKeyDown();","css":"amc-body"}]},"format":"JSON","tplVersion":"5.1.6"}